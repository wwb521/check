{"ast":null,"code":"export default {\n  name: 'StreamCheck',\n  data() {\n    return {\n      // No changes to data section\n    };\n  },\n  computed: {\n    // No changes to computed section\n  },\n  created() {\n    // No changes to created section\n  },\n  beforeDestroy() {\n    // No changes to beforeDestroy section\n  },\n  methods: {\n    async handleUrlFileUpload(event) {\n      const file = event.target.files[0];\n      if (!file) return;\n      try {\n        const content = await this.readFile(file);\n        // 按行分割，过滤空行和非URL格式的行\n        const urls = content.split('\\n').map(line => line.trim()).filter(line => line && /^https?:\\/\\/.+/.test(line));\n        if (urls.length === 0) {\n          this.$message.warning('未找到有效的URL');\n          return;\n        }\n\n        // 确保 urls 是数组\n        if (!Array.isArray(this.collectForm.urls)) {\n          this.$set(this.collectForm, 'urls', []);\n        }\n\n        // 添加新的URL，去重\n        const existingUrls = new Set(this.collectForm.urls);\n        urls.forEach(url => {\n          if (!existingUrls.has(url)) {\n            this.collectForm.urls.push(url);\n            existingUrls.add(url);\n          }\n        });\n        this.$message.success(`成功导入 ${urls.length} 个链接`);\n      } catch (error) {\n        this.$message.error('读取文件失败：' + error.message);\n      } finally {\n        // 清除文件输入，允许重复选择同一文件\n        event.target.value = '';\n      }\n    },\n    async collect() {\n      try {\n        this.$message.info('开始采集直播源...');\n\n        // 通过后端进行采集\n        const response = await fetch('http://localhost:8080/api/collect', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            urls: this.collectForm.urls\n          })\n        });\n        if (!response.ok) throw new Error('采集请求失败');\n        const content = await response.text();\n        const newStreams = this.parseContent(content);\n\n        // 过滤重复的直播源\n        const existingUrls = new Set(this.streamList.map(s => s.url));\n        const uniqueStreams = newStreams.filter(s => !existingUrls.has(s.url));\n        if (uniqueStreams.length > 0) {\n          this.streamList.push(...uniqueStreams);\n          this.$message.success(`采集成功: 新增${uniqueStreams.length}个直播源`);\n        } else {\n          this.$message.info('未发现新的直播源');\n        }\n      } catch (error) {\n        this.$message.error('采集失败：' + error.message);\n        if (!this.collectForm.autoCollect) {\n          this.stopCollecting();\n        }\n      }\n    }\n  },\n  watch: {\n    // No changes to watch section\n  }\n  // No changes to other sections\n};","map":{"version":3,"names":["name","data","computed","created","beforeDestroy","methods","handleUrlFileUpload","event","file","target","files","content","readFile","urls","split","map","line","trim","filter","test","length","$message","warning","Array","isArray","collectForm","$set","existingUrls","Set","forEach","url","has","push","add","success","error","message","value","collect","info","response","fetch","method","headers","body","JSON","stringify","ok","Error","text","newStreams","parseContent","streamList","s","uniqueStreams","autoCollect","stopCollecting","watch"],"sources":["src/components/StreamCheck.vue"],"sourcesContent":["<template>\n  <!-- No changes to template section -->\n</template>\n\n<script>\nexport default {\n  name: 'StreamCheck',\n  data() {\n    return {\n      // No changes to data section\n    }\n  },\n  computed: {\n    // No changes to computed section\n  },\n  created() {\n    // No changes to created section\n  },\n  beforeDestroy() {\n    // No changes to beforeDestroy section\n  },\n  methods: {\n    async handleUrlFileUpload(event) {\n      const file = event.target.files[0]\n      if (!file) return\n\n      try {\n        const content = await this.readFile(file)\n        // 按行分割，过滤空行和非URL格式的行\n        const urls = content.split('\\n')\n          .map(line => line.trim())\n          .filter(line => line && /^https?:\\/\\/.+/.test(line))\n\n        if (urls.length === 0) {\n          this.$message.warning('未找到有效的URL')\n        return\n      }\n\n        // 确保 urls 是数组\n        if (!Array.isArray(this.collectForm.urls)) {\n          this.$set(this.collectForm, 'urls', [])\n        }\n\n        // 添加新的URL，去重\n        const existingUrls = new Set(this.collectForm.urls)\n        urls.forEach(url => {\n          if (!existingUrls.has(url)) {\n            this.collectForm.urls.push(url)\n            existingUrls.add(url)\n          }\n        })\n\n        this.$message.success(`成功导入 ${urls.length} 个链接`)\n      } catch (error) {\n        this.$message.error('读取文件失败：' + error.message)\n      } finally {\n        // 清除文件输入，允许重复选择同一文件\n        event.target.value = ''\n      }\n    },\n    async collect() {\n      try {\n        this.$message.info('开始采集直播源...')\n\n        // 通过后端进行采集\n        const response = await fetch('http://localhost:8080/api/collect', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            urls: this.collectForm.urls\n          })\n        })\n\n        if (!response.ok) throw new Error('采集请求失败')\n        const content = await response.text()\n\n        const newStreams = this.parseContent(content)\n        \n        // 过滤重复的直播源\n        const existingUrls = new Set(this.streamList.map(s => s.url))\n        const uniqueStreams = newStreams.filter(s => !existingUrls.has(s.url))\n        \n        if (uniqueStreams.length > 0) {\n          this.streamList.push(...uniqueStreams)\n          this.$message.success(`采集成功: 新增${uniqueStreams.length}个直播源`)\n        } else {\n          this.$message.info('未发现新的直播源')\n        }\n      } catch (error) {\n        this.$message.error('采集失败：' + error.message)\n        if (!this.collectForm.autoCollect) {\n          this.stopCollecting()\n        }\n      }\n    }\n  },\n  watch: {\n    // No changes to watch section\n  },\n  // No changes to other sections\n}\n</script>\n\n<style scoped>\n/* No changes to style section */\n\n.el-form-item.is-required .el-form-item__label:before {\n  content: '';  /* 移除必填星号 */\n}\n\n.setting-tip {\n  margin-left: 10px;\n  color: #909399;\n  font-size: 13px;\n}\n</style> "],"mappings":"AAKA;EACAA,IAAA;EACAC,KAAA;IACA;MACA;IAAA,CACA;EACA;EACAC,QAAA;IACA;EAAA,CACA;EACAC,QAAA;IACA;EAAA,CACA;EACAC,cAAA;IACA;EAAA,CACA;EACAC,OAAA;IACA,MAAAC,oBAAAC,KAAA;MACA,MAAAC,IAAA,GAAAD,KAAA,CAAAE,MAAA,CAAAC,KAAA;MACA,KAAAF,IAAA;MAEA;QACA,MAAAG,OAAA,cAAAC,QAAA,CAAAJ,IAAA;QACA;QACA,MAAAK,IAAA,GAAAF,OAAA,CAAAG,KAAA,OACAC,GAAA,CAAAC,IAAA,IAAAA,IAAA,CAAAC,IAAA,IACAC,MAAA,CAAAF,IAAA,IAAAA,IAAA,qBAAAG,IAAA,CAAAH,IAAA;QAEA,IAAAH,IAAA,CAAAO,MAAA;UACA,KAAAC,QAAA,CAAAC,OAAA;UACA;QACA;;QAEA;QACA,KAAAC,KAAA,CAAAC,OAAA,MAAAC,WAAA,CAAAZ,IAAA;UACA,KAAAa,IAAA,MAAAD,WAAA;QACA;;QAEA;QACA,MAAAE,YAAA,OAAAC,GAAA,MAAAH,WAAA,CAAAZ,IAAA;QACAA,IAAA,CAAAgB,OAAA,CAAAC,GAAA;UACA,KAAAH,YAAA,CAAAI,GAAA,CAAAD,GAAA;YACA,KAAAL,WAAA,CAAAZ,IAAA,CAAAmB,IAAA,CAAAF,GAAA;YACAH,YAAA,CAAAM,GAAA,CAAAH,GAAA;UACA;QACA;QAEA,KAAAT,QAAA,CAAAa,OAAA,SAAArB,IAAA,CAAAO,MAAA;MACA,SAAAe,KAAA;QACA,KAAAd,QAAA,CAAAc,KAAA,aAAAA,KAAA,CAAAC,OAAA;MACA;QACA;QACA7B,KAAA,CAAAE,MAAA,CAAA4B,KAAA;MACA;IACA;IACA,MAAAC,QAAA;MACA;QACA,KAAAjB,QAAA,CAAAkB,IAAA;;QAEA;QACA,MAAAC,QAAA,SAAAC,KAAA;UACAC,MAAA;UACAC,OAAA;YACA;UACA;UACAC,IAAA,EAAAC,IAAA,CAAAC,SAAA;YACAjC,IAAA,OAAAY,WAAA,CAAAZ;UACA;QACA;QAEA,KAAA2B,QAAA,CAAAO,EAAA,YAAAC,KAAA;QACA,MAAArC,OAAA,SAAA6B,QAAA,CAAAS,IAAA;QAEA,MAAAC,UAAA,QAAAC,YAAA,CAAAxC,OAAA;;QAEA;QACA,MAAAgB,YAAA,OAAAC,GAAA,MAAAwB,UAAA,CAAArC,GAAA,CAAAsC,CAAA,IAAAA,CAAA,CAAAvB,GAAA;QACA,MAAAwB,aAAA,GAAAJ,UAAA,CAAAhC,MAAA,CAAAmC,CAAA,KAAA1B,YAAA,CAAAI,GAAA,CAAAsB,CAAA,CAAAvB,GAAA;QAEA,IAAAwB,aAAA,CAAAlC,MAAA;UACA,KAAAgC,UAAA,CAAApB,IAAA,IAAAsB,aAAA;UACA,KAAAjC,QAAA,CAAAa,OAAA,YAAAoB,aAAA,CAAAlC,MAAA;QACA;UACA,KAAAC,QAAA,CAAAkB,IAAA;QACA;MACA,SAAAJ,KAAA;QACA,KAAAd,QAAA,CAAAc,KAAA,WAAAA,KAAA,CAAAC,OAAA;QACA,UAAAX,WAAA,CAAA8B,WAAA;UACA,KAAAC,cAAA;QACA;MACA;IACA;EACA;EACAC,KAAA;IACA;EAAA;EAEA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}